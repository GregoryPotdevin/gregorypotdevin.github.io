
<html>
  <head>
    <style type="text/css">
      .baseDiv { 
        background: lime; 
      }
      .resizable { 
        background: cyan; 
        position: relative; 
        border: 1px;
        border-color: black; 
        z-index: 1;
      }
      
      .movable { 
        position: relative; 
        cursor: all-scroll; 
        z-index: 1;
      }

      .resizer.handle {
        width: 32px; 
        height: 100%;
        background-image:url(handle.png);
        background-position: center; 
        background-repeat:no-repeat;
        position:absolute; 
        cursor: ew-resize; 
        margin-top:auto;
        margin-bottom:auto;
      }
      .resizer.handle_right { 
        right: 0px;
        transform: translate(50%, 0);
      }
      .resizer.handle_left { 
        left: 0px;
        transform: translate(-50%, 0);
      }
    </style>
    <script type="text/javascript" src="libs/jquery.min.js"></script>
  </head>
  <body>
    <div style="display: block; padding: 40px;">
      <div id="p1" class="baseDiv" style="position: absolute; top: 0; left: 10%; width: 20%; height: 100px;"></div>
      <div id="p2" class="baseDiv" style="position: absolute; top: 50px; left: 5%; width: 20%; height: 100px;"></div>
    </div>
  </body>
  <script>

  var ArmaTools = ArmaTools || {};

  ArmaTools.Resizer = function()
  {

    var constrain = function(p, min, max){
      var left = parseInt(document.defaultView.getComputedStyle(p).left);
      var width = parseInt(document.defaultView.getComputedStyle(p).width, 10);
      if (left < min){
        p.style.left = min;
      } else if (left + width > max){
        p.style.left = max - width;
      }
    }

    var setupDrag = function(dragFn){
      document.documentElement.addEventListener('mousemove', dragFn, false);
      document.documentElement.addEventListener('mouseup', function stopDrag(){
        document.documentElement.removeEventListener('mousemove', dragFn, false);
        document.documentElement.removeEventListener('mouseup', stopDrag, false);
      }, false);
    }

    var initDragLeft = function(elem, min, max) {
      return function(e) {   
        e.stopPropagation();
        var startX = e.clientX;
        var left = parseInt(document.defaultView.getComputedStyle(elem).left);
        var width = parseInt(document.defaultView.getComputedStyle(elem).width, 10);
        setupDrag(function(e) {
          var newLeft =  (left + e.clientX - startX);
          elem.style.left = newLeft;
          elem.style.width = width + left - newLeft;
          constrain(p, min, max);
        });
      };
    }

    var initDragRight = function(elem, min, max) {
      return function(e) {   
        e.stopPropagation();
        var startX = e.clientX;
        var left = parseInt(document.defaultView.getComputedStyle(elem).left);
        var startWidth = parseInt(document.defaultView.getComputedStyle(elem).width, 10);
        setupDrag(function(e) {
          var width = (startWidth + e.clientX - startX);
          if (left + width > max){
            width = max-left;
          }
          elem.style.width = width + 'px';
        });
      };
    }

    var initMove = function(elem, min, max) {
      return function(e) { 
        e.stopPropagation();
        var startX = e.clientX;
        var left = parseInt(document.defaultView.getComputedStyle(elem).left);
        setupDrag(function(e) {
          var newLeft = (left + e.clientX - startX);
          elem.style.left = newLeft;
          constrain(elem, min, max);
        });
      };
    }

    var makeMovable = function(elem, min, max){
      elem.className = elem.className + ' movable';
      var listener = initMove(elem, min, max);
      elem.addEventListener('mousedown', listener, false);
      return {
        elem: elem,
        end: function(){
          elem.removeEventListener('mousedown', listener);
          elem.classList.remove('movable');
        }
      };
    }

    var makeResizable = function(elem, min, max){
      elem.classList.add('resizable');

      var noClick = function(e){e.stopPropagation();};

      var handleLeft = document.createElement('div');
      handleLeft.className = 'resizer handle handle_left';
      elem.appendChild(handleLeft);
      handleLeft.addEventListener('mousedown', initDragLeft(elem, min, max), false);
      handleLeft.addEventListener('click', noClick, false);
      
      var handleRight = document.createElement('div');
      handleRight.className = 'resizer handle handle_right';
      elem.appendChild(handleRight);
      handleRight.addEventListener('mousedown', initDragRight(elem, min, max), false);
      handleRight.addEventListener('click', noClick, false);

      return {
        elem: elem,
        handleLeft: handleLeft,
        handleRight: handleRight,
        end: function(){
          // TODO : Delete everything...
          elem.classList.remove('resizable');
          elem.removeChild(handleLeft);
          elem.removeChild(handleRight);
        }
      };
    }


    var oPublic =
    {
      makeResizable: makeResizable,
      makeMovable: makeMovable,
    };
    return oPublic;
  }();

var Resizer = ArmaTools.Resizer;


function initialize(p){
  p.addEventListener('click', function init(e) {
    // e.stopPropagation();
    var m = Resizer.makeMovable(p, 10, 500);
    var r = Resizer.makeResizable(p, 10, 500);
    p.removeEventListener('click', init, false);

    p.addEventListener('click', function reset(e){
      e.stopPropagation();
      console.log("stop");
      p.removeEventListener('click', reset, false);
      m.end();
      r.end();
      initialize(p);
    })
  }, false);
}


initialize(document.querySelector('#p1'));
initialize(document.querySelector('#p2'));

// var p2 = document.querySelector('div');

// p2.addEventListener('click', function init() {
//   Resizer.makeMovable(p2, 10, 500);
//   Resizer.makeResizable(p2, 10, 500);
//   p2.removeEventListener('click', init, false);
// }, false);

  </script>
</html>



